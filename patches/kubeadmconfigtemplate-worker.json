[
  {
    "op": "add",
    "path": "/metadata/name",
    "value": "${CLUSTER_NAME}-worker"
  },
  {
    "op": "remove",
    "path": "/metadata/namespace"
  },
  {
    "op": "add",
    "path": "/spec/template/spec/files/2/content",
    "value": "net.bridge.bridge-nf-call-iptables = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.ipv4.ip_forward = 1\nnet.ipv6.conf.all.forwarding = 1\nnet.ipv6.conf.all.accept_ra = 0\nnet.ipv6.conf.default.accept_ra = 0"
  },
  {
    "op": "add",
    "path": "/spec/template/spec/files/-",
    "value": {
      "path": "/etc/sysctl.d/99-fsnotify.conf",
      "content": "fs.inotify.max_user_instances = 8192\nfs.inotify.max_user_watches = 1048576\nfs.inotify.max_queued_events = 65536"
    }
  },
  {
    "op": "add",
    "path": "/spec/template/spec/preKubeadmCommands/-",
    "value": "sysctl --system"
  },
  {
    "op": "add",
    "path": "/spec/template/spec/preKubeadmCommands/-",
    "value": "ip -4 -o addr show scope global | awk '$4 ~ /^10\\./ {print $4}' | cut -d/ -f1 | head -n1 > /etc/private-ip"
  },
  {
    "op": "add",
    "path": "/spec/template/spec/preKubeadmCommands/-",
    "value": "echo \"KUBELET_EXTRA_ARGS=--node-ip=$(cat /etc/private-ip)\" > /etc/default/kubelet"
  }
]
